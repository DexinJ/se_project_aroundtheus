!function(){"use strict";class e{constructor(e,t,s,n,i,r){this._name=e.name,this._link=e.link,this._cardSelector=t,this._handleCardClick=n,this._owned=e.owner._id===s,this._id=e._id,this._handleCardDelete=i,this._like=e.likes.length,this._handleLike=r,this._likedByOwner=!1,e.likes.forEach((e=>{e._id===s&&(this._likedByOwner=!0)}))}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._deleteButton=this._element.querySelector(".card__delete-button"),this._likeButton=this._element.querySelector(".card__like-button"),this._image=this._element.querySelector(".card__image"),this._likeNumber=this._element.querySelector(".card__like-number"),this._setEventListeners(),this._image.src=this._link,this._image.alt=this._name,this._likeNumber.textContent=this._like,this._likedByOwner&&this._likeButton.classList.add("card__like-button_status_checked"),this._element.querySelector(".card__text").textContent=this._name,this._owned||this._deleteButton.remove(),this._element}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLike(this._id)})),this._owned&&this._deleteButton.addEventListener("click",(()=>{this._handleCardDelete(this._id)})),this._image.addEventListener("click",(()=>{this._handleOpenModal()}))}_handleOpenModal(){this._handleCardClick({name:this._name,link:this._link})}remove(){this._element.remove()}likedByOwner(){return this._likedByOwner}updateLike(e){this._like=e,this._likeNumber.textContent=this._like,this._likeButton.classList.toggle("card__like-button_status_checked"),this._likedByOwner=!this._likedByOwner}}class t{constructor(e,t){let{item:s,renderer:n}=e;this._item=s,this._renderer=n,this._section=document.querySelector(t)}renderItems(){this._section.innerHTML="",this._item.forEach((e=>{this._renderer(e,this._section)}))}addItem(e){this._section.prepend(e)}}class s{constructor(e){this._element=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._element.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._element.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&(console.log("closing"),this.close())}setEventListeners(){this._element.addEventListener("mousedown",(e=>{e.target.classList.contains("modal_opened")&&this.close(),e.target.classList.contains("modal__close")&&this.close()}))}}class n{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}enableValidation(){this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._setEventListeners()}_setEventListeners(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._inputElement=e,this._checkInputValidity(),this._toggleButtonState()}))}))}resetValidation(){this._inputList.forEach((e=>{this._inputElement=e,this._hideInputError()})),this._toggleButtonState()}_checkInputValidity(){this._inputElement.validity.valid?this._hideInputError():this._showInputError()}_showInputError(){const e=this._formElement.querySelector(`#${this._inputElement.id}-error`);this._inputElement.classList.add(this._inputErrorClass),e.textContent=this._inputElement.validationMessage,e.classList.add(this._errorClass)}_hideInputError(){const e=this._formElement.querySelector(`#${this._inputElement.id}-error`);this._inputElement.classList.remove(this._inputErrorClass),e.textContent="",e.classList.remove(this._errorClass)}_hasInvalidInput(){return this._valid=!0,this._inputList.forEach((e=>{e.validity.valid||(this._valid=!1)})),!this._valid}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}}const i={inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_active"},r=document.forms["profile-form"],o=document.forms["add-form"],a=document.forms["profilePic-form"],l=document.querySelector(".profile__button_type_edit"),h=document.querySelector(".profile__button_type_add"),c=r.querySelector("[name = 'name']"),_=r.querySelector("[name = 'about']"),u=new class{constructor(e){this._nameSelector=e.nameSelector,this._jobSelector=e.jobSelector,this._avatarSelector=e.avatarSelector,this._name=document.querySelector(this._nameSelector),this._job=document.querySelector(this._jobSelector),this._avatar=document.querySelector(this._avatarSelector)}getUserInfo(){return{name:this._name.textContent,about:this._job.textContent}}setUserInfo(e){let{name:t,about:s,avatar:n,_id:i}=e;console.log(n),this._name.textContent=t,this._job.textContent=s,this._avatar.src=n,this.userId=i}}({nameSelector:".profile__name",jobSelector:".profile__title",avatarSelector:".profile__image"}),d=new class extends s{constructor(e){super(e),this._image=this._element.querySelector(".modal__image"),this._caption=this._element.querySelector(".modal__caption")}open(e){let{name:t,link:s}=e;this._image.src=s,this._image.alt=t,this._caption.textContent=t,super.open()}}("#pictureModal"),m=new n(i,r),p=new n(i,o),E=new n(i,a),f=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._auth=s.authorization,this._contentType=s.contentType}getUser(){return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._auth}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getInitCards(){return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._auth}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editProfile(e){let{name:t,about:s}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:{authorization:this._auth,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:s})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addCard(e){let{name:t,link:s}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:{authorization:this._auth,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:s})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:this._auth,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}toggleLike(e,t){return t?fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:{authorization:this._auth,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))):fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:{authorization:this._auth,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateProfilePicture(e){let{link:t}=e;return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:{authorization:this._auth,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"b11a73f6-210f-4a22-80fa-1200af39d0e9","Content-Type":"application/json"}});class v extends s{constructor(e,t){super(e),this._form=this._element.querySelector(".modal__form"),this._submitFunction=t,this._inputs=this._element.querySelectorAll(".modal__input"),this._button=this._element.querySelector(".modal__button")}_getInputValues(){return this._inputValues={},this._inputs.forEach((e=>{this._inputValues[e.name]=e.value})),this._inputValues}setEventListeners(){super.setEventListeners(),this._element.addEventListener("submit",(e=>{e.preventDefault(),this._submitFunction(this._getInputValues()),this.close()}))}close(){this._form.reset(),super.close()}setButtonText(e){this._button.textContent=e}}const k=new class extends s{constructor(e){super(e),this._button=this._element.querySelector(".modal__button")}setEventListeners(){super.setEventListeners(),this._button.addEventListener("click",this._setClickActionWrapper)}_setClickActionWrapper=e=>{e.preventDefault(),this._confirmDelete()};setClickAction(e){this._confirmDelete=e}setButtonText(e){this._button.textContent=e}}("#deleteModal"),y=new v("#nameModal",(function(e){y.setButtonText("Saving..."),f.editProfile(e).then((e=>{u.setUserInfo(e)})).catch((e=>{console.error(e)})).finally((()=>{y.setButtonText("Save")}))})),b=new v("#addImageModal",(function(e){b.setButtonText("Saving..."),f.addCard(e).then((e=>{new t({item:{},renderer:()=>{}},".gallery__cards").addItem(g(e))})).catch((e=>{console.error(e)})).finally((()=>{b.setButtonText("Create")}))})),S=new v("#profilePictureModal",(function(e){S.setButtonText("Saving..."),f.updateProfilePicture(e).then((e=>{u.setUserInfo(e)})).catch((e=>{console.error(e)})).finally((()=>{S.setButtonText("Save")}))})),C=new class{constructor(e,t){this._element=document.querySelector(e),this._handleImageEdit=t,console.log(this._element)}setEventListeners(){this._element.addEventListener("click",this._handleImageEdit)}}(".profile__image-container",(()=>{S.open()}));function g(t){const s=new e(t,"#card",u.userId,L,(e=>{!function(e,t){k.open(),k.setClickAction((()=>{k.setButtonText("Saving..."),f.deleteCard(t).then((()=>{e.remove(),k.close()})).catch((e=>{console.error(e)})).finally((()=>{k.setButtonText("Yes")}))})),k.open()}(s,e)}),(e=>{f.toggleLike(e,s.likedByOwner()).then((e=>{s.updateLike(e.likes.length)})).catch((e=>{console.error(e)}))}));return s.generateCard()}function L(e){d.open(e)}l.addEventListener("click",(()=>{!function(){const e=u.getUserInfo();c.value=e.name,_.value=e.about}(),m.resetValidation(),y.open()})),h.addEventListener("click",(()=>{p.resetValidation(),b.open()})),C.setEventListeners(),y.setEventListeners(),b.setEventListeners(),d.setEventListeners(),k.setEventListeners(),S.setEventListeners(),m.enableValidation(),p.enableValidation(),E.enableValidation(),m.resetValidation(),p.resetValidation(),E.resetValidation(),Array.from(document.querySelectorAll(".modal")).forEach((e=>{e.classList.add("modal__transition")})),f.getUser().then((e=>{u.setUserInfo(e)})).catch((e=>{console.error(e)})),f.getInitCards().then((e=>{new t({item:e,renderer:(e,t)=>{t.append(g(e))}},".gallery__cards").renderItems()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUE5RXJDLFdBQ0UsTUFBTThKLEVBQWNuRixFQUFLVSxjQUN6QlosRUFBVStELE1BQVFzQixFQUFZaE0sS0FDOUI0RyxFQUFXOEQsTUFBUXNCLEVBQVl4RSxLQUNqQyxDQTJFRXlFLEdBQ0FsRSxFQUFxQnJDLGtCQUNyQnlGLEVBQWE1SCxNQUFNLElBR3JCbUQsRUFBVXhFLGlCQUFpQixTQUFTLEtBQ2xDOEYsRUFBaUJ0QyxrQkFDakI4RixFQUFXakksTUFBTSxJQWlEbkJvSSxFQUFhN0gsb0JBQ2JxSCxFQUFhckgsb0JBQ2IwSCxFQUFXMUgsb0JBQ1g4RCxFQUFhOUQsb0JBQ2JnSCxFQUFZaEgsb0JBQ1o0SCxFQUFnQjVILG9CQW5CZGlFLEVBQXFCaEQsbUJBQ3JCaUQsRUFBaUJqRCxtQkFDakJrRCxFQUF3QmxELG1CQUN4QmdELEVBQXFCckMsa0JBQ3JCc0MsRUFBaUJ0QyxrQkFDakJ1QyxFQUF3QnZDLGtCQUlUUCxNQUFNQyxLQUFLbkUsU0FBU29FLGlCQUFpQixXQUM3Q3ZFLFNBQVNvTCxJQUNkQSxFQUFNbkssVUFBVUMsSUFBSSxvQkFBb0IsSUFZNUNrRyxFQUFBQSxVQUVHVSxNQUFNQyxJQUNMaEMsRUFBS1ksWUFBWW9CLEVBQUksSUFFdEJ1QyxPQUFPQyxJQUNOekgsUUFBUTBILE1BQU1ELEVBQUksSUFHdEJuRCxFQUFJaUIsZUFBZVAsTUFBTUMsSUFDSCxJQUFJdEcsRUFDdEIsQ0FDRUcsS0FBTW1HLEVBQ05sRyxTQUFVQSxDQUFDRCxFQUFNeUosS0FDZkEsRUFBUUMsT0FBT1gsRUFBVy9JLEdBQU0sR0FHcEMsbUJBRVVLLGFBQWEsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbnMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1Byb2ZpbGVJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGRhdGEsXHJcbiAgICBjYXJkU2VsZWN0b3IsXHJcbiAgICBpZCxcclxuICAgIGhhbmRsZUNhcmRDbGljayxcclxuICAgIGhhbmRsZUNhcmREZWxldGUsXHJcbiAgICBoYW5kbGVMaWtlXHJcbiAgKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgIHRoaXMuX293bmVkID0gZGF0YS5vd25lci5faWQgPT09IGlkO1xyXG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUgPSBoYW5kbGVDYXJkRGVsZXRlO1xyXG4gICAgdGhpcy5fbGlrZSA9IGRhdGEubGlrZXMubGVuZ3RoO1xyXG4gICAgdGhpcy5faGFuZGxlTGlrZSA9IGhhbmRsZUxpa2U7XHJcbiAgICB0aGlzLl9saWtlZEJ5T3duZXIgPSBmYWxzZTtcclxuICAgIGRhdGEubGlrZXMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xyXG4gICAgICBpZiAoZWxlbWVudC5faWQgPT09IGlkKSB7XHJcbiAgICAgICAgdGhpcy5fbGlrZWRCeU93bmVyID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcclxuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XHJcbiAgICB0aGlzLl9pbWFnZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX2xpa2VOdW1iZXIgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1udW1iZXJcIik7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5faW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2ltYWdlLmFsdCA9IHRoaXMuX25hbWU7XHJcbiAgICB0aGlzLl9saWtlTnVtYmVyLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZTtcclxuICAgIGlmICh0aGlzLl9saWtlZEJ5T3duZXIpIHtcclxuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fc3RhdHVzX2NoZWNrZWRcIik7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGV4dFwiKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcbiAgICBpZiAoIXRoaXMuX293bmVkKSB7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fbGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVMaWtlKHRoaXMuX2lkKTtcclxuICAgIH0pO1xyXG4gICAgaWYgKHRoaXMuX293bmVkKSB7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUodGhpcy5faWQpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuX2ltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZU9wZW5Nb2RhbCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlT3Blbk1vZGFsKCkge1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKHsgbmFtZTogdGhpcy5fbmFtZSwgbGluazogdGhpcy5fbGluayB9KTtcclxuICB9XHJcblxyXG4gIHJlbW92ZSgpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgfVxyXG5cclxuICBsaWtlZEJ5T3duZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbGlrZWRCeU93bmVyO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlTGlrZShsaWtlcykge1xyXG4gICAgdGhpcy5fbGlrZSA9IGxpa2VzO1xyXG4gICAgdGhpcy5fbGlrZU51bWJlci50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2U7XHJcbiAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9zdGF0dXNfY2hlY2tlZFwiKTtcclxuICAgIHRoaXMuX2xpa2VkQnlPd25lciA9IHRoaXMuX2xpa2VkQnlPd25lciA/IGZhbHNlIDogdHJ1ZTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBpdGVtLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5faXRlbSA9IGl0ZW07XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fc2VjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVySXRlbXMoKSB7XHJcbiAgICB0aGlzLl9zZWN0aW9uLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICB0aGlzLl9pdGVtLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSwgdGhpcy5fc2VjdGlvbik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fc2VjdGlvbi5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRXNjQ2xvc2UoZXZlbnQpIHtcclxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgY29uc29sZS5sb2coXCJjbG9zaW5nXCIpO1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fY2xvc2VcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybSkge1xyXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxyXG4gICAgKTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRFbGVtZW50ID0gaW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eSgpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIHRoaXMuX2lucHV0RWxlbWVudCA9IGlucHV0RWxlbWVudDtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9XHJcblxyXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoKSB7XHJcbiAgICBpZiAoIXRoaXMuX2lucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvcigpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAjJHt0aGlzLl9pbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIHRoaXMuX2lucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLl9pbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcigpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAjJHt0aGlzLl9pbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIHRoaXMuX2lucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfaGFzSW52YWxpZElucHV0KCkge1xyXG4gICAgdGhpcy5fdmFsaWQgPSB0cnVlO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICAgIHRoaXMuX3ZhbGlkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiAhdGhpcy5fdmFsaWQ7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcclxuXHJcbi8vIGV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXHJcbi8vICAge1xyXG4vLyAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcclxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC95b3NlbWl0ZS5qcGdcIixcclxuLy8gICB9LFxyXG4vLyAgIHtcclxuLy8gICAgIG5hbWU6IFwiTGFrZSBMb3Vpc2VcIixcclxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWtlLWxvdWlzZS5qcGdcIixcclxuLy8gICB9LFxyXG4vLyAgIHtcclxuLy8gICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcclxuLy8gICB9LFxyXG4vLyAgIHtcclxuLy8gICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxyXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhdGVtYXIuanBnXCIsXHJcbi8vICAgfSxcclxuLy8gICB7XHJcbi8vICAgICBuYW1lOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxyXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3Zhbm9pc2UuanBnXCIsXHJcbi8vICAgfSxcclxuLy8gICB7XHJcbi8vICAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFnby5qcGdcIixcclxuLy8gICB9LFxyXG4vLyBdO1xyXG5cclxuY29uc3QgdmFsaWRhdGlvblNldHRpbmdzID0ge1xyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXQtZXJyb3JfYWN0aXZlXCIsXHJcbn07XHJcblxyXG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wicHJvZmlsZS1mb3JtXCJdO1xyXG5jb25zdCBhZGRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJhZGQtZm9ybVwiXTtcclxuY29uc3QgcGljdHVyZUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcInByb2ZpbGVQaWMtZm9ybVwiXTtcclxuZXhwb3J0IGNvbnN0IG5hbWVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvbl90eXBlX2VkaXRcIik7XHJcbmV4cG9ydCBjb25zdCBhZGRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvbl90eXBlX2FkZFwiKTtcclxuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IHByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZSA9ICduYW1lJ11cIik7XHJcbmV4cG9ydCBjb25zdCB0aXRsZUlucHV0ID0gcHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIltuYW1lID0gJ2Fib3V0J11cIik7XHJcbmV4cG9ydCBjb25zdCB1c2VyID0gbmV3IFVzZXJJbmZvKHtcclxuICBuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcclxuICBqb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fdGl0bGVcIixcclxuICBhdmF0YXJTZWxlY3RvcjogXCIucHJvZmlsZV9faW1hZ2VcIixcclxufSk7XHJcbmV4cG9ydCBjb25zdCBwaWN0dXJlTW9kYWwgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjcGljdHVyZU1vZGFsXCIpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXHJcbiAgcHJvZmlsZUZvcm1cclxuKTtcclxuZXhwb3J0IGNvbnN0IGFkZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcih2YWxpZGF0aW9uU2V0dGluZ3MsIGFkZEZvcm0pO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZVBpY0Zvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXHJcbiAgcGljdHVyZUZvcm1cclxuKTtcclxuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lblwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiYjExYTczZjYtMjEwZi00YTIyLTgwZmEtMTIwMGFmMzlkMGU5XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKHNlbGVjdG9ycykge1xyXG4gICAgdGhpcy5fbmFtZVNlbGVjdG9yID0gc2VsZWN0b3JzLm5hbWVTZWxlY3RvcjtcclxuICAgIHRoaXMuX2pvYlNlbGVjdG9yID0gc2VsZWN0b3JzLmpvYlNlbGVjdG9yO1xyXG4gICAgdGhpcy5fYXZhdGFyU2VsZWN0b3IgPSBzZWxlY3RvcnMuYXZhdGFyU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9uYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9uYW1lU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fam9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9qb2JTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9hdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2F2YXRhclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5fbmFtZS50ZXh0Q29udGVudCxcclxuICAgICAgYWJvdXQ6IHRoaXMuX2pvYi50ZXh0Q29udGVudCxcclxuICAgIH07XHJcbiAgfVxyXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQsIGF2YXRhciwgX2lkIH0pIHtcclxuICAgIGNvbnNvbGUubG9nKGF2YXRhcik7XHJcbiAgICB0aGlzLl9uYW1lLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX2pvYi50ZXh0Q29udGVudCA9IGFib3V0O1xyXG4gICAgdGhpcy5fYXZhdGFyLnNyYyA9IGF2YXRhcjtcclxuICAgIHRoaXMudXNlcklkID0gX2lkO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fY2FwdGlvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcclxuICB9XHJcblxyXG4gIG9wZW4oeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHRoaXMuX2ltYWdlLnNyYyA9IGxpbms7XHJcbiAgICB0aGlzLl9pbWFnZS5hbHQgPSBuYW1lO1xyXG4gICAgdGhpcy5fY2FwdGlvbi50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5fYXV0aCA9IGhlYWRlcnMuYXV0aG9yaXphdGlvbjtcclxuICAgIHRoaXMuX2NvbnRlbnRUeXBlID0gaGVhZGVycy5jb250ZW50VHlwZTtcclxuICB9XHJcblxyXG4gIGdldFVzZXIoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aCB9LFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEluaXRDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiB0aGlzLl9hdXRoIH0sXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZWRpdFByb2ZpbGUoeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aCxcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgYWJvdXQ6IGFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl9hdXRoLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGgsXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIH0sXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdG9nZ2xlTGlrZShpZCwgbGlrZWQpIHtcclxuICAgIGlmIChsaWtlZCkge1xyXG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtpZH1gLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGgsXHJcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICB9LFxyXG4gICAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2lkfWAsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aCxcclxuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdXBkYXRlUHJvZmlsZVBpY3R1cmUoeyBsaW5rIH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aCxcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvciwgc3VibWl0RnVuY3Rpb24pIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuICAgIHRoaXMuX3N1Ym1pdEZ1bmN0aW9uID0gc3VibWl0RnVuY3Rpb247XHJcbiAgICB0aGlzLl9pbnB1dHMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpO1xyXG4gICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XHJcbiAgfVxyXG5cclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dFZhbHVlcyA9IHt9O1xyXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIHRoaXMuX2lucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLl9pbnB1dFZhbHVlcztcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5fc3VibWl0RnVuY3Rpb24odGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgc2V0QnV0dG9uVGV4dCh0ZXh0KSB7XHJcbiAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSB0ZXh0O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb25zLmpzXCI7XHJcbmltcG9ydCBQcm9maWxlSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUHJvZmlsZUltYWdlLmpzXCI7XHJcbmltcG9ydCB7XHJcbiAgbmFtZUJ1dHRvbixcclxuICBhZGRCdXR0b24sXHJcbiAgbmFtZUlucHV0LFxyXG4gIHRpdGxlSW5wdXQsXHJcbiAgdXNlcixcclxuICBwaWN0dXJlTW9kYWwsXHJcbiAgcHJvZmlsZUZvcm1WYWxpZGF0b3IsXHJcbiAgYWRkRm9ybVZhbGlkYXRvcixcclxuICBwcm9maWxlUGljRm9ybVZhbGlkYXRvcixcclxuICBhcGksXHJcbn0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm0uanNcIjtcclxuXHJcbmNvbnN0IGRlbGV0ZU1vZGFsID0gbmV3IFBvcHVwV2l0aENvbmZpcm0oXCIjZGVsZXRlTW9kYWxcIik7XHJcbmNvbnN0IHByb2ZpbGVNb2RhbCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI25hbWVNb2RhbFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbmNvbnN0IGltYWdlTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNhZGRJbWFnZU1vZGFsXCIsIGhhbmRsZUFkZEZvcm1TdWJtaXQpO1xyXG5jb25zdCBwcm9maWxlUGljTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNwcm9maWxlUGljdHVyZU1vZGFsXCIsXHJcbiAgaGFuZGxlUHJvZmlsZVBpY1N1Ym1pdFxyXG4pO1xyXG5jb25zdCBwcm9maWxlSW1hZ2UgPSBuZXcgUHJvZmlsZUltYWdlKFwiLnByb2ZpbGVfX2ltYWdlLWNvbnRhaW5lclwiLCAoKSA9PiB7XHJcbiAgcHJvZmlsZVBpY01vZGFsLm9wZW4oKTtcclxufSk7XHJcbmZ1bmN0aW9uIGZpbGxQcm9maWxlSW5wdXRzKCkge1xyXG4gIGNvbnN0IGN1cnJlbnRJbmZvID0gdXNlci5nZXRVc2VySW5mbygpO1xyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IGN1cnJlbnRJbmZvLm5hbWU7XHJcbiAgdGl0bGVJbnB1dC52YWx1ZSA9IGN1cnJlbnRJbmZvLmFib3V0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlUGljU3VibWl0KGRhdGEpIHtcclxuICBwcm9maWxlUGljTW9kYWwuc2V0QnV0dG9uVGV4dChcIlNhdmluZy4uLlwiKTtcclxuICBhcGlcclxuICAgIC51cGRhdGVQcm9maWxlUGljdHVyZShkYXRhKVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICB1c2VyLnNldFVzZXJJbmZvKHJlcyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcHJvZmlsZVBpY01vZGFsLnNldEJ1dHRvblRleHQoXCJTYXZlXCIpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGRhdGEpIHtcclxuICBwcm9maWxlTW9kYWwuc2V0QnV0dG9uVGV4dChcIlNhdmluZy4uLlwiKTtcclxuICBhcGlcclxuICAgIC5lZGl0UHJvZmlsZShkYXRhKVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICB1c2VyLnNldFVzZXJJbmZvKHJlcyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcHJvZmlsZU1vZGFsLnNldEJ1dHRvblRleHQoXCJTYXZlXCIpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUFkZEZvcm1TdWJtaXQoZGF0YSkge1xyXG4gIGltYWdlTW9kYWwuc2V0QnV0dG9uVGV4dChcIlNhdmluZy4uLlwiKTtcclxuICBhcGlcclxuICAgIC5hZGRDYXJkKGRhdGEpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaXRlbToge30sXHJcbiAgICAgICAgICByZW5kZXJlcjogKCkgPT4ge30sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcIi5nYWxsZXJ5X19jYXJkc1wiXHJcbiAgICAgICk7XHJcbiAgICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY3JlYXRlQ2FyZChyZXMpKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBpbWFnZU1vZGFsLnNldEJ1dHRvblRleHQoXCJDcmVhdGVcIik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZERlbGV0ZShjYXJkLCBpZCkge1xyXG4gIGRlbGV0ZU1vZGFsLm9wZW4oKTtcclxuICBkZWxldGVNb2RhbC5zZXRDbGlja0FjdGlvbigoKSA9PiB7XHJcbiAgICBkZWxldGVNb2RhbC5zZXRCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xyXG4gICAgYXBpXHJcbiAgICAgIC5kZWxldGVDYXJkKGlkKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgY2FyZC5yZW1vdmUoKTtcclxuICAgICAgICBkZWxldGVNb2RhbC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgfSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZU1vZGFsLnNldEJ1dHRvblRleHQoXCJZZXNcIik7XHJcbiAgICAgIH0pO1xyXG4gIH0pO1xyXG4gIGRlbGV0ZU1vZGFsLm9wZW4oKTtcclxufVxyXG5cclxubmFtZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGZpbGxQcm9maWxlSW5wdXRzKCk7XHJcbiAgcHJvZmlsZUZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgcHJvZmlsZU1vZGFsLm9wZW4oKTtcclxufSk7XHJcblxyXG5hZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGltYWdlTW9kYWwub3BlbigpO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoaXRlbSkge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGl0ZW0sXHJcbiAgICBcIiNjYXJkXCIsXHJcbiAgICB1c2VyLnVzZXJJZCxcclxuICAgIGhhbmRsZUNhcmRDbGljayxcclxuICAgIChpZCkgPT4ge1xyXG4gICAgICBoYW5kbGVDYXJkRGVsZXRlKGNhcmQsIGlkKTtcclxuICAgIH0sXHJcbiAgICAoaWQpID0+IHtcclxuICAgICAgYXBpXHJcbiAgICAgICAgLnRvZ2dsZUxpa2UoaWQsIGNhcmQubGlrZWRCeU93bmVyKCkpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgY2FyZC51cGRhdGVMaWtlKHJlcy5saWtlcy5sZW5ndGgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICApO1xyXG4gIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkQ2xpY2soZGF0YSkge1xyXG4gIHBpY3R1cmVNb2RhbC5vcGVuKGRhdGEpO1xyXG59XHJcblxyXG4vLyBmdW5jdGlvbiBkaXNwbGF5Q2FyZHMoKSB7XHJcbi8vICAgY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuLy8gfVxyXG5cclxuZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICBwcm9maWxlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiAgYWRkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiAgcHJvZmlsZVBpY0Zvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG4gIHByb2ZpbGVGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGFkZEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgcHJvZmlsZVBpY0Zvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFwcGx5VHJhbnNpdGlvbigpIHtcclxuICBjb25zdCBtb2RhbHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIikpO1xyXG4gIG1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xyXG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX190cmFuc2l0aW9uXCIpO1xyXG4gIH0pO1xyXG59XHJcbnByb2ZpbGVJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5wcm9maWxlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuaW1hZ2VNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5waWN0dXJlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuZGVsZXRlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucHJvZmlsZVBpY01vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmFwcGx5VHJhbnNpdGlvbigpO1xyXG5hcGlcclxuICAuZ2V0VXNlcigpXHJcbiAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgdXNlci5zZXRVc2VySW5mbyhyZXMpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICB9KTtcclxuXHJcbmFwaS5nZXRJbml0Q2FyZHMoKS50aGVuKChyZXMpID0+IHtcclxuICBjb25zdCBjYXJkU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxyXG4gICAge1xyXG4gICAgICBpdGVtOiByZXMsXHJcbiAgICAgIHJlbmRlcmVyOiAoaXRlbSwgc2VjdGlvbikgPT4ge1xyXG4gICAgICAgIHNlY3Rpb24uYXBwZW5kKGNyZWF0ZUNhcmQoaXRlbSkpO1xyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIFwiLmdhbGxlcnlfX2NhcmRzXCJcclxuICApO1xyXG4gIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XHJcbn0pO1xyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvblwiKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fc2V0Q2xpY2tBY3Rpb25XcmFwcGVyKTtcclxuICB9XHJcblxyXG4gIF9zZXRDbGlja0FjdGlvbldyYXBwZXIgPSAoZXZlbnQpID0+IHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB0aGlzLl9jb25maXJtRGVsZXRlKCk7XHJcbiAgfTtcclxuXHJcbiAgc2V0Q2xpY2tBY3Rpb24oZnVuYykge1xyXG4gICAgdGhpcy5fY29uZmlybURlbGV0ZSA9IGZ1bmM7XHJcbiAgfVxyXG5cclxuICBzZXRCdXR0b25UZXh0KHRleHQpIHtcclxuICAgIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2ZpbGVJbWFnZSB7XHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3IsIGhhbmRsZUltYWdlRWRpdCkge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlSW1hZ2VFZGl0ID0gaGFuZGxlSW1hZ2VFZGl0O1xyXG4gICAgY29uc29sZS5sb2codGhpcy5fZWxlbWVudCk7XHJcbiAgfVxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlSW1hZ2VFZGl0KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJpZCIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZUNhcmREZWxldGUiLCJoYW5kbGVMaWtlIiwidGhpcyIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX293bmVkIiwib3duZXIiLCJfaWQiLCJfaGFuZGxlQ2FyZERlbGV0ZSIsIl9saWtlIiwibGlrZXMiLCJsZW5ndGgiLCJfaGFuZGxlTGlrZSIsIl9saWtlZEJ5T3duZXIiLCJmb3JFYWNoIiwiZWxlbWVudCIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJnZW5lcmF0ZUNhcmQiLCJfZWxlbWVudCIsIl9kZWxldGVCdXR0b24iLCJfbGlrZUJ1dHRvbiIsIl9pbWFnZSIsIl9saWtlTnVtYmVyIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZU9wZW5Nb2RhbCIsImxpa2VkQnlPd25lciIsInVwZGF0ZUxpa2UiLCJ0b2dnbGUiLCJTZWN0aW9uIiwiX3JlZiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbSIsInJlbmRlcmVyIiwiX2l0ZW0iLCJfcmVuZGVyZXIiLCJfc2VjdGlvbiIsInJlbmRlckl0ZW1zIiwiaW5uZXJIVE1MIiwiYWRkSXRlbSIsInByZXBlbmQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5IiwiY29uc29sZSIsImxvZyIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiZW5hYmxlVmFsaWRhdGlvbiIsIl9idXR0b25FbGVtZW50IiwicHJldmVudERlZmF1bHQiLCJfaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0RWxlbWVudCIsIl9pbnB1dEVsZW1lbnQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwicmVzZXRWYWxpZGF0aW9uIiwiX2hpZGVJbnB1dEVycm9yIiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9zaG93SW5wdXRFcnJvciIsImVycm9yRWxlbWVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hhc0ludmFsaWRJbnB1dCIsIl92YWxpZCIsImRpc2FibGVkIiwidmFsaWRhdGlvblNldHRpbmdzIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsImFkZEZvcm0iLCJwaWN0dXJlRm9ybSIsIm5hbWVCdXR0b24iLCJhZGRCdXR0b24iLCJuYW1lSW5wdXQiLCJ0aXRsZUlucHV0IiwidXNlciIsInNlbGVjdG9ycyIsIl9uYW1lU2VsZWN0b3IiLCJuYW1lU2VsZWN0b3IiLCJfam9iU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsIl9hdmF0YXJTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX2pvYiIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsImFib3V0Iiwic2V0VXNlckluZm8iLCJhdmF0YXIiLCJ1c2VySWQiLCJwaWN0dXJlTW9kYWwiLCJzdXBlciIsIl9jYXB0aW9uIiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJhZGRGb3JtVmFsaWRhdG9yIiwicHJvZmlsZVBpY0Zvcm1WYWxpZGF0b3IiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2F1dGgiLCJhdXRob3JpemF0aW9uIiwiX2NvbnRlbnRUeXBlIiwiY29udGVudFR5cGUiLCJnZXRVc2VyIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRDYXJkcyIsImVkaXRQcm9maWxlIiwiX3JlZjIiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJfcmVmMyIsImRlbGV0ZUNhcmQiLCJ0b2dnbGVMaWtlIiwibGlrZWQiLCJ1cGRhdGVQcm9maWxlUGljdHVyZSIsIl9yZWY0IiwiUG9wdXBXaXRoRm9ybSIsInN1Ym1pdEZ1bmN0aW9uIiwiX2Zvcm0iLCJfc3VibWl0RnVuY3Rpb24iLCJfaW5wdXRzIiwiX2J1dHRvbiIsIl9nZXRJbnB1dFZhbHVlcyIsIl9pbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZXNldCIsInNldEJ1dHRvblRleHQiLCJ0ZXh0IiwiZGVsZXRlTW9kYWwiLCJfc2V0Q2xpY2tBY3Rpb25XcmFwcGVyIiwiX2NvbmZpcm1EZWxldGUiLCJzZXRDbGlja0FjdGlvbiIsImZ1bmMiLCJwcm9maWxlTW9kYWwiLCJjYXRjaCIsImVyciIsImVycm9yIiwiZmluYWxseSIsImltYWdlTW9kYWwiLCJjcmVhdGVDYXJkIiwicHJvZmlsZVBpY01vZGFsIiwicHJvZmlsZUltYWdlIiwic2VsZWN0b3IiLCJoYW5kbGVJbWFnZUVkaXQiLCJfaGFuZGxlSW1hZ2VFZGl0IiwiY2FyZCIsImN1cnJlbnRJbmZvIiwiZmlsbFByb2ZpbGVJbnB1dHMiLCJtb2RhbCIsInNlY3Rpb24iLCJhcHBlbmQiXSwic291cmNlUm9vdCI6IiJ9